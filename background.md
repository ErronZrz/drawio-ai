## drawio MCP Server èƒ½åŠ›æ¦‚è¿°

æ ¹æ®å·²è¿æ¥çš„ MCP æœåŠ¡ä¿¡æ¯ï¼Œ**drawio MCP Server** æä¾›äº†ä»¥ä¸‹ **5 ä¸ªæ ¸å¿ƒåŠŸèƒ½**ï¼š

| å·¥å…·åç§° | åŠŸèƒ½è¯´æ˜ |
|---------|---------|
| `start_session` | å¯åŠ¨æ–°çš„ç»˜å›¾ä¼šè¯ï¼Œè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è¿›è¡Œå®æ—¶é¢„è§ˆ |
| `display_diagram` | ä» XML åˆ›å»ºå¹¶æ˜¾ç¤º**å…¨æ–°çš„** draw.io å›¾è¡¨ï¼ˆä¼šæ›¿æ¢æ•´ä¸ªå›¾è¡¨ï¼‰ |
| `edit_diagram` | é€šè¿‡ ID æ“ä½œç¼–è¾‘å½“å‰å›¾è¡¨ï¼Œæ”¯æŒ `add`ï¼ˆæ·»åŠ ï¼‰ã€`update`ï¼ˆæ›´æ–°ï¼‰ã€`delete`ï¼ˆåˆ é™¤ï¼‰å•å…ƒæ ¼ |
| `get_diagram` | è·å–å½“å‰å›¾è¡¨çš„ XMLï¼ˆä»æµè§ˆå™¨è·å–æœ€æ–°çŠ¶æ€ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ‰‹åŠ¨ç¼–è¾‘çš„å†…å®¹ï¼‰ |
| `export_diagram` | å°†å½“å‰å›¾è¡¨å¯¼å‡ºä¸º `.drawio` æ–‡ä»¶ |

### è¯¦ç»†è¯´æ˜

1. **`start_session`**
   - å¯åŠ¨åµŒå…¥å¼æœåŠ¡å™¨å¹¶æ‰“å¼€æµè§ˆå™¨çª—å£
   - å®æ—¶æ˜¾ç¤ºå›¾è¡¨æ›´æ–°

2. **`display_diagram`**
   - è¾“å…¥ï¼šæœ‰æ•ˆçš„ draw.io/mxGraph XML æ ¼å¼
   - ç”¨äºä»é›¶å¼€å§‹åˆ›å»ºæ–°å›¾è¡¨
   - âš ï¸ ä¼š**å®Œå…¨æ›¿æ¢**å½“å‰å›¾è¡¨

3. **`edit_diagram`**
   - æ”¯æŒä¸‰ç§æ“ä½œï¼š
     - `add`ï¼šæ·»åŠ æ–°å…ƒç´ ï¼ˆéœ€æä¾›æ–°çš„ `cell_id` å’Œ `new_xml`ï¼‰
     - `update`ï¼šæ›´æ–°ç°æœ‰å…ƒç´ ï¼ˆéœ€å…ˆè°ƒç”¨ `get_diagram` è·å–å½“å‰ IDï¼‰
     - `delete`ï¼šåˆ é™¤å…ƒç´ ï¼ˆåªéœ€ `cell_id`ï¼‰
   - ä¼šè‡ªåŠ¨ä¿ç•™ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­çš„æ‰‹åŠ¨ä¿®æ”¹

4. **`get_diagram`**
   - è¿”å›å½“å‰å›¾è¡¨çš„å®Œæ•´ XML
   - åœ¨æ‰§è¡Œ `update` æˆ– `delete` å‰å»ºè®®å…ˆè°ƒç”¨æ­¤å·¥å…·

5. **`export_diagram`**
   - è¾“å…¥ï¼šæ–‡ä»¶ä¿å­˜è·¯å¾„ï¼ˆå¦‚ `./diagram.drawio`ï¼‰
   - å¯¼å‡ºä¸ºæ ‡å‡† `.drawio` æ ¼å¼ï¼Œå¯ç”¨ draw.io æ¡Œé¢ç‰ˆæˆ–åœ¨çº¿ç‰ˆæ‰“å¼€

### å…¸å‹ä½¿ç”¨æµç¨‹

```
start_session â†’ display_diagram â†’ [edit_diagram] â†’ export_diagram
                                       â†‘
                              get_diagramï¼ˆæŸ¥çœ‹å½“å‰çŠ¶æ€ï¼‰
```

è¿™ä¸ª MCP Server éå¸¸é€‚åˆç”¨äºå¿«é€Ÿç”Ÿæˆå’Œç¼–è¾‘æ¶æ„å›¾ã€æµç¨‹å›¾ã€ç¤ºæ„å›¾ç­‰æŠ€æœ¯æ–‡æ¡£ä¸­çš„å›¾è¡¨ï¼

## é—®é¢˜

å¦‚æœæˆ‘æœ‰ä¸€ä¸ªåŸŸåã€ä¸€å°ä¸ªäººæœåŠ¡å™¨ï¼ˆå·²ç»ä½¿ç”¨ Caddy åå‘ä»£ç†äº†å¤šä¸ªå­åŸŸååˆ°ä¸€äº› Docker Compose å®¹å™¨ä¸Šï¼‰ï¼Œä¹Ÿæœ‰ä¸€äº› GLM é¢åº¦ï¼Œæƒ³è¦åˆ›å»ºä¸€ä¸ª drawio ç»˜å›¾ Web åº”ç”¨ï¼Œæ”¯æŒï¼š
- è®¿é—®ç½‘ç«™æ—¶ï¼Œé¡µé¢æ˜¾ç¤ºä¸€ä¸ªå…¥å£æŒ‰é’®ï¼Œç”¨æˆ·ç‚¹å‡»åˆ™ä¸ºè¯¥ç”¨æˆ·åˆ›å»ºä¸€ä¸ª sessionï¼Œå¹¶æä¾›è®©ç”¨æˆ·æŸ¥çœ‹çš„ URLï¼›
- ç”¨æˆ·å¯ä»¥å¼€å§‹å’Œ GLM è¿›è¡Œå¯¹è¯ï¼Œè¡¨è¾¾è‡ªå·±çš„éœ€æ±‚ï¼ŒGLM æ‰§è¡Œç»˜å›¾ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶é€šè¿‡ä¸Šä¸€æ­¥è·å–çš„ URL æŸ¥çœ‹ï¼›
- ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹å¹¶è¦æ±‚ GLM ç»§ç»­ä¿®æ”¹ï¼Œç›´è‡³æ»¡æ„ï¼Œç„¶åé€šè¿‡ç½‘ç«™ä¸Šçš„ä¸‹è½½åŠŸèƒ½å°† drawio æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼ˆæš‚ä¸ç”¨è€ƒè™‘å…¶ä»–æ ¼å¼çš„æ–‡ä»¶å¯¼å‡ºï¼‰ã€‚

è¯·å¸®åŠ©æˆ‘æ¢³ç†å®ç°æ­¥éª¤ã€‚

## ğŸ¨ åŸºäº drawio MCP Server çš„ Web ç»˜å›¾åº”ç”¨å®ç°æ–¹æ¡ˆ

æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œæˆ‘æ¥å¸®ä½ æ¢³ç†å®Œæ•´çš„å®ç°æ­¥éª¤ã€‚è¿™ä¸ªæ–¹æ¡ˆå°†æ„å»ºä¸€ä¸ª **å‰åç«¯åˆ†ç¦»** çš„ Web åº”ç”¨ï¼Œæ ¸å¿ƒæ˜¯å°† drawio MCP Server èƒ½åŠ›å°è£…ä¸º Web æœåŠ¡ã€‚

---

## ä¸€ã€æ•´ä½“æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç”¨æˆ·æµè§ˆå™¨                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   å…¥å£é¡µé¢    â”‚    â”‚   å¯¹è¯ç•Œé¢    â”‚    â”‚  å›¾è¡¨é¢„è§ˆé¡µ   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                   â”‚                   â”‚
          â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åç«¯æœåŠ¡ (FastAPI/Flask)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Session ç®¡ç†  â”‚    â”‚  GLM å¯¹è¯    â”‚    â”‚ å›¾è¡¨æ¸²æŸ“/å¯¼å‡º â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                   â”‚                   â”‚
          â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    drawio MCP Server (æ ¸å¿ƒå¼•æ“)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚start_session â”‚    â”‚display/edit  â”‚    â”‚export_diagramâ”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æŠ€æœ¯æ ˆå»ºè®®

| å±‚æ¬¡ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|-----|---------|------|
| **å‰ç«¯** | Vue.js + Tailwind CSS | ç®€æ´ç°ä»£çš„ UI |
| **åç«¯** | Python FastAPI | å¼‚æ­¥æ”¯æŒå¥½ï¼Œé€‚åˆæµå¼å¯¹è¯ |
| **AI å¯¹è¯** | æ™ºè°± GLM API | ä½ å·²æœ‰é¢åº¦ |
| **ç»˜å›¾å¼•æ“** | drawio MCP Server | æ ¸å¿ƒèƒ½åŠ›æä¾›è€… |
| **ä¼šè¯å­˜å‚¨** | Redis / SQLite | å­˜å‚¨ç”¨æˆ· session å’Œå›¾è¡¨æ•°æ® |
| **åå‘ä»£ç†** | Caddy | ä½ å·²æœ‰çš„åŸºç¡€è®¾æ–½ |
| **å®¹å™¨åŒ–** | Docker Compose | ä¾¿äºéƒ¨ç½² |

---

## ä¸‰ã€è¯¦ç»†å®ç°æ­¥éª¤

### ğŸ“¦ ç¬¬ä¸€æ­¥ï¼šé¡¹ç›®åˆå§‹åŒ–

```
drawio-web/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py              # FastAPI å…¥å£
â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”œâ”€â”€ session.py       # Session ç®¡ç†æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py          # GLM å¯¹è¯æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ diagram.py       # å›¾è¡¨æ“ä½œæ¥å£
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ mcp_client.py    # MCP Server å®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ glm_service.py   # GLM API å°è£…
â”‚   â”‚   â”‚   â””â”€â”€ session_manager.py
â”‚   â”‚   â””â”€â”€ models/
â”‚   â”‚       â””â”€â”€ schemas.py       # Pydantic æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”œâ”€â”€ Home.vue         # å…¥å£é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Chat.vue         # å¯¹è¯ç•Œé¢
â”‚   â”‚   â”‚   â””â”€â”€ Preview.vue      # å›¾è¡¨é¢„è§ˆ
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ Caddyfile                    # å¦‚å·²åœ¨æœåŠ¡å™¨ /etc/caddy ä¸­è®¾ç½®ï¼Œå¯ç›´æ¥æ›´æ–°
```

---

### ğŸ”§ ç¬¬äºŒæ­¥ï¼šåç«¯æ ¸å¿ƒæ¨¡å—å®ç°

#### 2.1 MCP Client å°è£… (`mcp_client.py`)

```python
import subprocess
import json
from typing import Dict, Any

class DrawioMCPClient:
    """å°è£… drawio MCP Server è°ƒç”¨"""
    
    def __init__(self):
        self.sessions: Dict[str, Any] = {}  # session_id -> session_info
    
    async def start_session(self, session_id: str) -> dict:
        """ä¸ºç”¨æˆ·åˆ›å»ºæ–°çš„ç»˜å›¾ä¼šè¯"""
        # è°ƒç”¨ MCP Server çš„ start_session
        # è¿”å› preview_url
        pass
    
    async def display_diagram(self, session_id: str, xml: str) -> bool:
        """æ˜¾ç¤º/æ›¿æ¢æ•´ä¸ªå›¾è¡¨"""
        pass
    
    async def edit_diagram(self, session_id: str, operations: list) -> bool:
        """ç¼–è¾‘å›¾è¡¨ï¼ˆæ·»åŠ /æ›´æ–°/åˆ é™¤å…ƒç´ ï¼‰"""
        pass
    
    async def get_diagram(self, session_id: str) -> str:
        """è·å–å½“å‰å›¾è¡¨ XML"""
        pass
    
    async def export_diagram(self, session_id: str) -> bytes:
        """å¯¼å‡ºä¸º .drawio æ–‡ä»¶å†…å®¹"""
        pass
```

#### 2.2 GLM æœåŠ¡å°è£… (`glm_service.py`)

```python
from zhipuai import ZhipuAI

class GLMService:
    """æ™ºè°± GLM API å°è£…"""
    
    SYSTEM_PROMPT = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å›¾è¡¨ç»˜åˆ¶åŠ©æ‰‹ï¼Œä½¿ç”¨ draw.io æ ¼å¼ã€‚
    ç”¨æˆ·ä¼šæè¿°ä»–ä»¬æƒ³è¦çš„å›¾è¡¨ï¼Œä½ éœ€è¦ï¼š
    1. ç†è§£ç”¨æˆ·éœ€æ±‚
    2. ç”Ÿæˆç¬¦åˆ mxGraph XML æ ¼å¼çš„å›¾è¡¨ä»£ç 
    3. æ”¯æŒå¢é‡ä¿®æ”¹ç°æœ‰å›¾è¡¨
    
    è¾“å‡ºæ ¼å¼è¦æ±‚ï¼š
    - æ–°å»ºå›¾è¡¨æ—¶è¿”å›å®Œæ•´çš„ mxGraphModel XML
    - ä¿®æ”¹å›¾è¡¨æ—¶è¿”å›æ“ä½œæŒ‡ä»¤ JSONï¼ˆadd/update/deleteï¼‰
    """
    
    def __init__(self, api_key: str):
        self.client = ZhipuAI(api_key=api_key)
    
    async def chat(self, user_message: str, current_diagram_xml: str = None) -> dict:
        """
        ä¸ GLM å¯¹è¯ï¼Œè¿”å›ç»˜å›¾æŒ‡ä»¤
        è¿”å›: {"action": "display" | "edit", "data": xml_or_operations}
        """
        pass
```

#### 2.3 API è·¯ç”±è®¾è®¡

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|-----|------|------|
| `/api/session` | POST | åˆ›å»ºæ–°ä¼šè¯ï¼Œè¿”å› session_id å’Œ preview_url |
| `/api/session/{id}` | GET | è·å–ä¼šè¯çŠ¶æ€ |
| `/api/chat/{session_id}` | POST | å‘é€æ¶ˆæ¯ç»™ GLMï¼Œæµå¼è¿”å› |
| `/api/diagram/{session_id}` | GET | è·å–å½“å‰å›¾è¡¨ XML |
| `/api/diagram/{session_id}/download` | GET | ä¸‹è½½ .drawio æ–‡ä»¶ |

---

### ğŸ¨ ç¬¬ä¸‰æ­¥ï¼šå‰ç«¯é¡µé¢å®ç°

#### 3.1 å…¥å£é¡µé¢ (`Home.vue`)

```vue
<template>
  <div class="flex flex-col items-center justify-center min-h-screen">
    <h1 class="text-3xl font-bold mb-8">AI ç»˜å›¾åŠ©æ‰‹</h1>
    <button @click="createSession" class="btn-primary">
      å¼€å§‹ç»˜å›¾
    </button>
  </div>
</template>

<script setup>
const createSession = async () => {
  const res = await fetch('/api/session', { method: 'POST' })
  const { session_id, preview_url } = await res.json()
  // è·³è½¬åˆ°å¯¹è¯é¡µé¢ï¼ŒåŒæ—¶æ‰“å¼€é¢„è§ˆçª—å£
  window.open(preview_url, '_blank')
  router.push(`/chat/${session_id}`)
}
</script>
```

#### 3.2 å¯¹è¯ç•Œé¢ (`Chat.vue`)

- å·¦ä¾§ï¼šèŠå¤©æ¶ˆæ¯åˆ—è¡¨ + è¾“å…¥æ¡†
- å³ä¾§ï¼šåµŒå…¥çš„ iframe é¢„è§ˆï¼ˆæˆ–æä¾›è·³è½¬é“¾æ¥ï¼‰
- åº•éƒ¨ï¼šä¸‹è½½æŒ‰é’®

#### 3.3 é¢„è§ˆé¡µé¢

ç›´æ¥ä½¿ç”¨ drawio MCP Server æä¾›çš„é¢„è§ˆ URLï¼ˆå¦‚ `http://localhost:6002?mcp=session_id`ï¼‰

---

### ğŸ³ ç¬¬å››æ­¥ï¼šDocker Compose éƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8005:8005"
    environment:
      - GLM_API_KEY=${GLM_API_KEY}
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis
      - drawio-mcp
  
  frontend:
    build: ./frontend
    ports:
      - "3005:80"
  
  drawio-mcp:
    image: node:18
    command: npx @next-ai-drawio/mcp-server@latest
    ports:
      - "6002:6002"
  
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
```

---

### ğŸŒ ç¬¬äº”æ­¥ï¼šCaddy åå‘ä»£ç†é…ç½®

```caddyfile
# Caddyfile
drawio.yourdomain.com {
    # å‰ç«¯
    handle / {
        reverse_proxy frontend:3005
    }
    
    # åç«¯ API
    handle /api/* {
        reverse_proxy backend:8005
    }
    
    # drawio é¢„è§ˆ
    handle /preview/* {
        reverse_proxy drawio-mcp:6002
    }
}
```

---

## å››ã€å…³é”®æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

| éš¾ç‚¹ | è§£å†³æ–¹æ¡ˆ |
|-----|---------|
| **MCP Server å¤šä¼šè¯æ”¯æŒ** | ä¸ºæ¯ä¸ªç”¨æˆ·å¯åŠ¨ç‹¬ç«‹çš„ MCP è¿›ç¨‹ï¼Œæˆ–ä¿®æ”¹ MCP Server æ”¯æŒå¤šä¼šè¯ |
| **GLM ç”Ÿæˆæœ‰æ•ˆçš„ mxGraph XML** | åœ¨ Prompt ä¸­æä¾› XML æ¨¡æ¿å’Œç¤ºä¾‹ï¼Œåšå¥½è¾“å‡ºæ ¼å¼æ ¡éªŒ |
| **å®æ—¶é¢„è§ˆåŒæ­¥** | ä½¿ç”¨ WebSocket æ¨é€å›¾è¡¨æ›´æ–°äº‹ä»¶ |
| **ä¼šè¯æŒä¹…åŒ–** | Redis å­˜å‚¨ä¼šè¯çŠ¶æ€ï¼Œæ”¯æŒæ–­çº¿é‡è¿ |

---

## äº”ã€å¼€å‘ä¼˜å…ˆçº§å»ºè®®

1. **P0 - MVP æ ¸å¿ƒåŠŸèƒ½**
   - [ ] åç«¯ MCP Client å°è£…
   - [ ] GLM å¯¹è¯ + å›¾è¡¨ç”Ÿæˆ
   - [ ] åŸºç¡€å‰ç«¯é¡µé¢

2. **P1 - å®Œæ•´ä½“éªŒ**
   - [ ] ä¼šè¯ç®¡ç†ï¼ˆåˆ›å»º/æ¢å¤ï¼‰
   - [ ] ä¸‹è½½åŠŸèƒ½
   - [ ] Docker éƒ¨ç½²

3. **P2 - ä¼˜åŒ–å¢å¼º**
   - [ ] æµå¼å¯¹è¯å“åº”
   - [ ] å†å²è®°å½•ä¿å­˜
   - [ ] å¤šç§å›¾è¡¨æ¨¡æ¿

---

## å…­ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨

ä½ æƒ³å…ˆä»å“ªä¸ªéƒ¨åˆ†å¼€å§‹å®ç°ï¼Ÿæˆ‘å¯ä»¥å¸®ä½ ï¼š

1. **æ­å»ºé¡¹ç›®éª¨æ¶** - ç”Ÿæˆå®Œæ•´çš„é¡¹ç›®ç›®å½•å’ŒåŸºç¡€ä»£ç 
2. **å®ç° MCP Client** - å°è£… drawio MCP Server çš„ Python å®¢æˆ·ç«¯
3. **è®¾è®¡ GLM Prompt** - ä¼˜åŒ–æç¤ºè¯ä»¥ç”Ÿæˆé«˜è´¨é‡çš„ mxGraph XML
4. **ç¼–å†™ Docker Compose** - å®Œæ•´çš„éƒ¨ç½²é…ç½®

è¯·å‘Šè¯‰æˆ‘ä½ çš„ä¼˜å…ˆçº§ï¼Œæˆ‘ä»¬é€æ­¥æ¨è¿›ï¼

---

## ä¸ƒã€é¡¹ç›®è¿›å±•è®°å½•

### âœ… å·²å®Œæˆï¼ˆ2024-12-18ï¼‰

#### 1. åº”ç”¨éª¨æ¶æ­å»º

**åç«¯ (FastAPI)**
- `backend/app/main.py` - FastAPI å…¥å£ï¼Œé…ç½® CORS
- `backend/app/routers/session.py` - ä¼šè¯ç®¡ç† API
- `backend/app/routers/chat.py` - GLM å¯¹è¯ APIï¼ˆæµå¼å“åº”ï¼‰
- `backend/app/routers/diagram.py` - å›¾è¡¨æ“ä½œ API
- `backend/app/services/session_manager.py` - ä¼šè¯ç®¡ç†å™¨
- `backend/app/services/glm_service.py` - GLM æœåŠ¡å°è£…
- `backend/app/services/mcp_client.py` - MCP å®¢æˆ·ç«¯å°è£…
- `backend/app/models/schemas.py` - Pydantic æ•°æ®æ¨¡å‹
- `backend/requirements.txt` - Python ä¾èµ–

**å‰ç«¯ (Vue 3 + Vite)**
- `frontend/src/views/Home.vue` - å…¥å£é¡µé¢
- `frontend/src/views/Chat.vue` - å¯¹è¯ç•Œé¢
- `frontend/src/views/Preview.vue` - å›¾è¡¨é¢„è§ˆé¡µ
- `frontend/src/router/index.js` - è·¯ç”±é…ç½®
- `frontend/src/App.vue` - æ ¹ç»„ä»¶
- `frontend/src/style.css` - Tailwind CSS

**éƒ¨ç½²é…ç½®**
- `docker-compose.yml` - å®¹å™¨ç¼–æ’
- `Caddyfile` - åå‘ä»£ç†é…ç½®

#### 2. API Key éªŒè¯

- âœ… åˆ›å»ºæµ‹è¯•è„šæœ¬ `backend/tests/test_glm_api.py`
- âœ… é…ç½®æ™ºè°± Coding APIï¼ˆOpenAI å…¼å®¹æ¨¡å¼ï¼‰
  - Base URL: `https://open.bigmodel.cn/api/coding/paas/v4`
  - æ¨¡å‹: `GLM-4.6`
  - **æ³¨æ„**ï¼šGLM Coding å¥—é¤ä¸åŒäºé€šç”¨ APIï¼Œä¸“é—¨ç”¨äºç¼–ç¨‹éœ€æ±‚ã€‚
- âœ… è§£å†³ SSL éªŒè¯é—®é¢˜ï¼ˆé€‚é… Whistle ä»£ç†ï¼‰
- âœ… API è¿æ¥æµ‹è¯•é€šè¿‡
- âœ… å›¾è¡¨ XML ç”Ÿæˆæµ‹è¯•é€šè¿‡

#### 3. å¯åŠ¨è„šæœ¬

- âœ… åˆ›å»º `start.sh` ä¸€é”®å¯åŠ¨è„šæœ¬
  - è‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒä¾èµ–
  - åŒæ—¶å¯åŠ¨å‰åç«¯æœåŠ¡
  - æ”¯æŒ Ctrl+C ä¼˜é›…åœæ­¢

---

### ğŸ“‹ åç»­è§„åˆ’

#### é˜¶æ®µä¸€ï¼šæœ¬åœ°å¼€å‘ç¯å¢ƒå®Œå–„ (P0)

| ä»»åŠ¡ | è¯´æ˜ | çŠ¶æ€ |
|-----|------|------|
| åç«¯æœåŠ¡è°ƒè¯• | å¯åŠ¨ FastAPIï¼ŒéªŒè¯å„æ¥å£ | å¾…å¼€å§‹ |
| å‰ç«¯æœåŠ¡è°ƒè¯• | å¯åŠ¨ Viteï¼ŒéªŒè¯é¡µé¢æ¸²æŸ“ | å¾…å¼€å§‹ |
| å‰åç«¯è”è°ƒ | æµ‹è¯•å®Œæ•´ç”¨æˆ·æµç¨‹ | å¾…å¼€å§‹ |

#### é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½å®ç° (P0)

| ä»»åŠ¡ | è¯´æ˜ | çŠ¶æ€ |
|-----|------|------|
| MCP å®¢æˆ·ç«¯é€šä¿¡ | å®ç°ä¸ drawio MCP Server çš„çœŸå®é€šä¿¡ | å¾…å¼€å§‹ |
| GLM Prompt ä¼˜åŒ– | è®¾è®¡é«˜è´¨é‡çš„å›¾è¡¨ç”Ÿæˆæç¤ºè¯ | å¾…å¼€å§‹ |
| å›¾è¡¨é¢„è§ˆé›†æˆ | å°† MCP Server é¢„è§ˆé¡µé¢é›†æˆåˆ°å‰ç«¯ | å¾…å¼€å§‹ |
| ä¸‹è½½åŠŸèƒ½ | å®ç° .drawio æ–‡ä»¶å¯¼å‡ºä¸‹è½½ | å¾…å¼€å§‹ |

#### é˜¶æ®µä¸‰ï¼šéƒ¨ç½²ä¸Šçº¿ (P1)

| ä»»åŠ¡ | è¯´æ˜ | çŠ¶æ€ |
|-----|------|------|
| Docker é•œåƒæ„å»º | æ„å»ºå‰åç«¯ Docker é•œåƒ | å¾…å¼€å§‹ |
| Docker Compose éƒ¨ç½² | åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²å®Œæ•´åº”ç”¨ | å¾…å¼€å§‹ |
| Caddy é…ç½® | é…ç½®å­åŸŸååå‘ä»£ç† | å¾…å¼€å§‹ |
| HTTPS è¯ä¹¦ | Caddy è‡ªåŠ¨ç”³è¯· Let's Encrypt è¯ä¹¦ | å¾…å¼€å§‹ |

#### é˜¶æ®µå››ï¼šä½“éªŒä¼˜åŒ– (P2)

| ä»»åŠ¡ | è¯´æ˜ | çŠ¶æ€ |
|-----|------|------|
| æµå¼å“åº”ä¼˜åŒ– | GLM å¯¹è¯æµå¼è¾“å‡ºåˆ°å‰ç«¯ | å¾…å¼€å§‹ |
| ä¼šè¯æŒä¹…åŒ– | Redis å­˜å‚¨ä¼šè¯ï¼Œæ”¯æŒæ–­çº¿é‡è¿ | å¾…å¼€å§‹ |
| UI ç¾åŒ– | ä¼˜åŒ–äº¤äº’ä½“éªŒå’Œè§†è§‰æ•ˆæœ | å¾…å¼€å§‹ |
| å›¾è¡¨æ¨¡æ¿ | æä¾›å¸¸ç”¨å›¾è¡¨æ¨¡æ¿å¿«é€Ÿå¼€å§‹ | å¾…å¼€å§‹ |

---

### ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

**ç«‹å³å¯æ‰§è¡Œï¼š**

```bash
# 1. å¯åŠ¨åº”ç”¨
./start.sh

# 2. è®¿é—®æœåŠ¡
# - å‰ç«¯: http://localhost:3005
# - åç«¯ API æ–‡æ¡£: http://localhost:8005/docs
```

**ä¼˜å…ˆå¤„ç†ï¼š**
1. éªŒè¯å‰åç«¯æœåŠ¡èƒ½å¦æ­£å¸¸å¯åŠ¨
2. æµ‹è¯•åˆ›å»ºä¼šè¯ â†’ å¯¹è¯ â†’ æŸ¥çœ‹å›¾è¡¨çš„å®Œæ•´æµç¨‹
3. æ ¹æ®å®é™…è°ƒè¯•æƒ…å†µå®Œå–„ MCP å®¢æˆ·ç«¯é€šä¿¡é€»è¾‘